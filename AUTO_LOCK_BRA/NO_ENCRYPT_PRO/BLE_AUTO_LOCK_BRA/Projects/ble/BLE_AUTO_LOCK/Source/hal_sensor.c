/**************************************************************************************************
  Filename:       hal_sensor.c
  Revised:        $Date: 2012-09-21 06:30:38 -0700 (Fri, 21 Sep 2012) $
  Revision:       $Revision: 31581 $

  Description:    This file contains code that is common to all sensor drivers.


  Copyright 2012 Texas Instruments Incorporated. All rights reserved.

  IMPORTANT: Your use of this Software is limited to those specific rights
  granted under the terms of a software license agreement between the user
  who downloaded the software, his/her employer (which must be your employer)
  and Texas Instruments Incorporated (the "License").  You may not use this
  Software unless you agree to abide by the terms of the License. The License
  limits your use, and you acknowledge, that the Software may not be modified,
  copied or distributed unless embedded on a Texas Instruments microcontroller
  or used solely and exclusively in conjunction with a Texas Instruments radio
  frequency transceiver, which is integrated into your product.  Other than for
  the foregoing purpose, you may not use, reproduce, copy, prepare derivative
  works of, modify, distribute, perform, display or sell this Software and/or
  its documentation for any purpose.

  YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
  PROVIDED AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
  INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
  NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
  TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
  NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
  LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
  INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
  OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
  OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
  (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.

  Should you have any questions regarding your right to use this Software,
  contact Texas Instruments Incorporated at www.TI.com.
**************************************************************************************************/

/* ------------------------------------------------------------------------------------------------
*                                          Includes
* ------------------------------------------------------------------------------------------------
*/
#include "hal_sensor.h"
#include "hal_i2c.h"
#include "hal_led.h"


/* ------------------------------------------------------------------------------------------------
*                                           Macros and constants
* ------------------------------------------------------------------------------------------------
*/


/* ------------------------------------------------------------------------------------------------
*                                           Local Variables
* ------------------------------------------------------------------------------------------------
*/
static uint8 buffer[24];
uint8 bbb[7];


/*********************************************************************
 * Globalvariables
 */
 
uint8 writeBuffer[2];
uint8 buttonStatusBackUp = 0;
uint16 buttonStatus = 0;

//const uint8 test[10] @0x8000;
//#pragma location="BANK7"
const unsigned char Font_Menu_Num[] = 
{

  0x00,0x00,0x00,0x00, 0x00,0xE0,0x10,0x08,0x08,0x10,0xE0,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00, 0x00,0x0F,0x10,0x20,0x20,0x10,0x0F,0x00,0x00,0x00,0x00,0x00,//"0",0
 
  0x00,0x00,0x00,0x00, 0x00,0x00,0x10,0x10,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00, 0x00,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00,0x00,0x00,0x00,//"1",1
  
  0x00,0x00,0x00,0x00, 0x00,0x70,0x08,0x08,0x08,0x08,0xF0,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00, 0x00,0x30,0x28,0x24,0x22,0x21,0x30,0x00,0x00,0x00,0x00,0x00,//"2",2
  
  0x00,0x00,0x00,0x00, 0x00,0x30,0x08,0x08,0x08,0x88,0x70,0x00,0x00,0x00,0x00,0x00, 
  0x00,0x00,0x00,0x00, 0x00,0x18,0x20,0x21,0x21,0x22,0x1C,0x00,0x00,0x00,0x00,0x00, //"3",3
  
  0x00,0x00,0x00,0x00, 0x00,0x00,0x80,0x40,0x30,0xF8,0x00,0x00,0x00,0x00,0x00,0x00, 
  0x00,0x00,0x00,0x00, 0x00,0x06,0x05,0x24,0x24,0x3F,0x24,0x24,0x00,0x00,0x00,0x00, //"4",4
  
  0x00,0x00,0x00,0x00, 0x00,0xF8,0x88,0x88,0x88,0x08,0x08,0x00,0x00,0x00,0x00,0x00, 
  0x00,0x00,0x00,0x00, 0x00,0x19,0x20,0x20,0x20,0x11,0x0E,0x00,0x00,0x00,0x00,0x00, //"5",5
  
  0x00,0x00,0x00,0x00, 0x00,0xE0,0x10,0x88,0x88,0x90,0x00,0x00,0x00,0x00,0x00,0x00, 
  0x00,0x00,0x00,0x00, 0x00,0x0F,0x11,0x20,0x20,0x20,0x1F,0x00,0x00,0x00,0x00,0x00, //"6",6
  
  0x00,0x00,0x00,0x00, 0x00,0x18,0x08,0x08,0x88,0x68,0x18,0x00,0x00,0x00,0x00,0x00, 
  0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x3E,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00, //"7",7
  
  0x00,0x00,0x00,0x00, 0x00,0x70,0x88,0x08,0x08,0x88,0x70,0x00,0x00,0x00,0x00,0x00, 
  0x00,0x00,0x00,0x00, 0x00,0x1C,0x22,0x21,0x21,0x22,0x1C,0x00,0x00,0x00,0x00,0x00, //"8",8
  
  0x00,0x00,0x00,0x00, 0x00,0xF0,0x08,0x08,0x08,0x10,0xE0,0x00,0x00,0x00,0x00,0x00, 
  0x00,0x00,0x00,0x00, 0x00,0x01,0x12,0x22,0x22,0x11,0x0F,0x00,0x00,0x00,0x00,0x00, //"9",9
  
  0x00,0x00,0x00,0x00, 0x40,0x40,0x80,0xF0,0x80,0x40,0x40,0x00,0x00,0x00,0x00,0x00, 
  0x00,0x00,0x00,0x00, 0x02,0x02,0x01,0x0F,0x01,0x02,0x02,0x00,0x00,0x00,0x00,0x00, //"*",10
  
  0x00,0x00,0x00,0x00, 0x00,0x40,0xC0,0x78,0x40,0xC0,0x78,0x00,0x00,0x00,0x00,0x00, 
  0x00,0x00,0x00,0x00, 0x00,0x04,0x3F,0x04,0x04,0x3F,0x04,0x00,0x00,0x00,0x00,0x00, //"#",11
  
//  0x00,0x00,0x10,0x10, 0xF8,0x00,0x00,0x00, 0x00,0xE0,0x10,0x08,0x08,0x10,0xE0,0x00,
//  0x00,0x00,0x20,0x20, 0x3F,0x20,0x20,0x00, 0x00,0x0F,0x10,0x20,0x20,0x10,0x0F,0x00,//"10",12
  
} ;

//#pragma location="BANK4"
/***************************16*16的点阵字体取模方式：共阴――列行式――逆向输出*********/
const unsigned char Font_Menu_Fir[] = 	  	 
{
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,// 空格,0
  0x10,0x94,0x53,0x32,0x1E,0x32,0x52,0x10,0x00,0x7E,0x42,0x42,0x42,0x7E,0x00,0x00,
  0x00,0x00,0x00,0xFF,0x49,0x49,0x49,0x49,0x49,0x49,0x49,0xFF,0x00,0x00,0x00,0x00,//"智",1
  0x08,0xCC,0x4A,0x49,0x48,0x4A,0xCC,0x18,0x00,0x7F,0x88,0x88,0x84,0x82,0xE0,0x00,
  0x00,0xFF,0x12,0x12,0x52,0x92,0x7F,0x00,0x00,0x7E,0x88,0x88,0x84,0x82,0xE0,0x00,//"能",2
  0x20,0x10,0x2C,0xE7,0x24,0x24,0x00,0xE2,0x2C,0x20,0xBF,0x20,0x28,0xE6,0x00,0x00,
  0x01,0x01,0x01,0x7F,0x21,0x11,0x80,0x4F,0x20,0x10,0x0F,0x10,0x20,0x4F,0x80,0x00,//"锁",3
  0x20,0x20,0xFF,0x20,0x24,0xF4,0x54,0x54,0x54,0xFF,0x54,0x55,0x56,0xF4,0x04,0x00,
  0x00,0x00,0xFF,0x00,0x08,0x0B,0x19,0x69,0x09,0x0B,0x49,0x89,0x7D,0x0B,0x08,0x00,//"博",4
  0x00,0x80,0x60,0xF8,0x47,0x40,0x44,0x44,0x44,0x7F,0x44,0x44,0x44,0x44,0x40,0x00,
  0x01,0x00,0x00,0xFF,0x40,0x40,0x44,0x44,0x44,0x7F,0x44,0x44,0x44,0x44,0x40,0x00,//"佳",5
  0x82,0x92,0x92,0xFE,0x92,0x92,0x82,0x00,0x82,0x92,0x92,0xFE,0x92,0x92,0x82,0x00,
  0x08,0x08,0x08,0x14,0x14,0x12,0x16,0x99,0x52,0x32,0x14,0x04,0x08,0x08,0x08,0x00,//"琴",6
  0x00,0x00,0xF8,0x88,0x88,0x88,0x88,0xFF,0x88,0x88,0x88,0x88,0xF8,0x00,0x00,0x00,
  0x00,0x00,0x1F,0x08,0x08,0x08,0x08,0x7F,0x88,0x88,0x88,0x88,0x9F,0x80,0xF0,0x00,//"电",7
  0x80,0x82,0x82,0x82,0x82,0x82,0x82,0xE2,0xA2,0x92,0x8A,0x86,0x82,0x80,0x80,0x00,
  0x00,0x00,0x00,0x00,0x00,0x40,0x80,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//"子",8
  0x24,0x24,0xA4,0xFE,0xA3,0x22,0x00,0x22,0xCC,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,
  0x08,0x06,0x01,0xFF,0x00,0x01,0x04,0x04,0x04,0x04,0x04,0xFF,0x02,0x02,0x02,0x00,//"科",9
  0x10,0x10,0x10,0xFF,0x10,0x90,0x08,0x88,0x88,0x88,0xFF,0x88,0x88,0x88,0x08,0x00,
  0x04,0x44,0x82,0x7F,0x01,0x80,0x80,0x40,0x43,0x2C,0x10,0x28,0x46,0x81,0x80,0x00,//"技",10
#if 1
  0x40,0x42,0xCC,0x00,0x00,0x44,0x54,0x54,0x54,0x7F,0x54,0x54,0x54,0x44,0x40,0x00,
  0x00,0x00,0x7F,0x20,0x10,0x00,0xFF,0x15,0x15,0x15,0x55,0x95,0x7F,0x00,0x00,0x00,//"请",11
  0x88,0x68,0x1F,0xC8,0x08,0x10,0xC8,0x54,0x52,0xD1,0x12,0x94,0x08,0xD0,0x10,0x00,
  0x09,0x19,0x09,0xFF,0x05,0x00,0xFF,0x12,0x92,0xFF,0x00,0x5F,0x80,0x7F,0x00,0x00,//"输",12
  0x00,0x00,0x00,0x00,0x00,0x01,0xE2,0x1C,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x80,0x40,0x20,0x10,0x0C,0x03,0x00,0x00,0x00,0x03,0x0C,0x30,0x40,0x80,0x80,0x00,//"入",13
  0x10,0x8C,0x44,0x04,0xE4,0x04,0x95,0xA6,0x44,0x24,0x14,0x84,0x44,0x94,0x0C,0x00,
  0x02,0x02,0x7A,0x41,0x41,0x43,0x42,0x7E,0x42,0x42,0x42,0x43,0xF8,0x00,0x00,0x00,//"密",14
  0x04,0x84,0xE4,0x5C,0x44,0xC4,0x00,0x02,0xF2,0x82,0x82,0x82,0xFE,0x80,0x80,0x00,
  0x02,0x01,0x7F,0x10,0x10,0x3F,0x00,0x08,0x08,0x08,0x08,0x48,0x88,0x40,0x3F,0x00,//"码",15
  0x02,0xFA,0x82,0x82,0xFE,0x80,0x40,0x20,0x50,0x4C,0x43,0x4C,0x50,0x20,0x40,0x00,
  
  0x08,0x18,0x48,0x84,0x44,0x3F,0x40,0x44,0x58,0x41,0x4E,0x60,0x58,0x47,0x40,0x00,//"验",16
  0x40,0x40,0x42,0xCC,0x00,0x00,0x04,0xC4,0x04,0x04,0xFC,0x04,0x04,0x04,0x04,0x00,
  0x00,0x00,0x00,0x3F,0x10,0x48,0x40,0x7F,0x40,0x40,0x7F,0x41,0x41,0x41,0x40,0x00,//"证",17
  0x40,0x42,0xCC,0x00,0x00,0xE2,0x22,0x2A,0x2A,0xF2,0x2A,0x26,0x22,0xE0,0x00,0x00,
  0x80,0x40,0x3F,0x40,0x80,0xFF,0x89,0x89,0x89,0xBF,0x89,0xA9,0xC9,0xBF,0x80,0x00,//"通",18
  0x40,0x40,0x42,0xCC,0x00,0x08,0x48,0x88,0x08,0x08,0x08,0xFF,0x08,0x08,0x08,0x00,
  0x00,0x40,0x20,0x1F,0x20,0x40,0x40,0x41,0x40,0x48,0x50,0x4F,0x40,0x40,0x40,0x00,//"过",19
  0x40,0x40,0x42,0xCC,0x00,0x80,0x88,0x88,0xFF,0x88,0x88,0xFF,0x88,0x88,0x80,0x00,
  0x00,0x40,0x20,0x1F,0x20,0x40,0x50,0x4C,0x43,0x40,0x40,0x5F,0x40,0x40,0x40,0x00,//"进",20
  0x00,0x00,0x00,0x00,0x00,0x01,0xE2,0x1C,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x80,0x40,0x20,0x10,0x0C,0x03,0x00,0x00,0x00,0x03,0x0C,0x30,0x40,0x80,0x80,0x00,//"入",21
  0x88,0x64,0x23,0xA2,0xA6,0xAA,0xA2,0xBA,0xA4,0xA3,0xA2,0x26,0x2A,0xA2,0x62,0x00,
  0x00,0x00,0x00,0xFF,0x4A,0x4A,0x4A,0x4A,0x4A,0x4A,0x4B,0xF8,0x00,0x00,0x00,0x00,//"管",22
  0x04,0x84,0x84,0xFC,0x84,0x84,0x00,0xFE,0x92,0x92,0xFE,0x92,0x92,0xFE,0x00,0x00,
  0x20,0x60,0x20,0x1F,0x10,0x10,0x40,0x44,0x44,0x44,0x7F,0x44,0x44,0x44,0x40,0x00,//"理",23
  0x00,0x00,0xC0,0x5E,0x52,0x52,0x52,0x52,0x52,0x52,0x52,0x5E,0xC0,0x00,0x00,0x00,
  0x80,0x80,0x8F,0x40,0x40,0x20,0x10,0x0E,0x10,0x10,0x20,0x20,0x4F,0x80,0x00,0x00,//"员",24
  0x10,0x10,0xD0,0xFF,0x90,0x14,0xE4,0xAF,0xA4,0xA4,0xA4,0xAF,0xE4,0x04,0x00,0x00,
  0x04,0x03,0x00,0xFF,0x00,0x89,0x4B,0x2A,0x1A,0x0E,0x1A,0x2A,0x4B,0x88,0x80,0x00,//"模",25
  0x10,0x10,0x90,0x90,0x90,0x90,0x90,0x10,0x10,0xFF,0x10,0x10,0x11,0x16,0x10,0x00,
  0x00,0x20,0x60,0x20,0x3F,0x10,0x10,0x10,0x00,0x03,0x0C,0x10,0x20,0x40,0xF8,0x00,//"式",26
  0x40,0x40,0x42,0xCC,0x00,0x00,0xFF,0x49,0x49,0xC9,0x49,0x49,0x7F,0x80,0x00,0x00,
  0x00,0x40,0x20,0x1F,0x20,0x40,0x5F,0x48,0x44,0x40,0x41,0x42,0x45,0x58,0x40,0x00,//"退",27
  0x00,0x00,0x7C,0x40,0x40,0x40,0x40,0xFF,0x40,0x40,0x40,0x40,0xFC,0x00,0x00,0x00,
  0x00,0x7C,0x40,0x40,0x40,0x40,0x40,0x7F,0x40,0x40,0x40,0x40,0x40,0xFC,0x00,0x00,//"出",28
  0x40,0x30,0xEF,0x24,0x64,0x48,0x48,0x7F,0x48,0x48,0x48,0x7F,0x48,0x48,0x40,0x00,
  0x01,0x01,0x7F,0x21,0x11,0x00,0xFF,0x49,0x49,0x49,0x49,0x49,0xFF,0x00,0x00,0x00,//"错",29
  0x40,0x42,0xCC,0x00,0x00,0x80,0x9E,0x92,0x92,0x92,0x92,0x92,0x9E,0x80,0x00,0x00,
  0x00,0x00,0x7F,0x20,0x94,0x84,0x44,0x24,0x14,0x0F,0x14,0x24,0x44,0x84,0x84,0x00,//"误",30
  0x10,0x10,0x14,0xD4,0x54,0x54,0x54,0xFC,0x52,0x52,0x52,0xD3,0x12,0x10,0x10,0x00,
  0x40,0x40,0x50,0x57,0x55,0x55,0x55,0x7F,0x55,0x55,0x55,0x57,0x50,0x40,0x40,0x00,//"重",31
  0x40,0x44,0x54,0x65,0xC6,0x64,0x54,0x44,0x00,0xFC,0x44,0x44,0xC4,0x42,0x40,0x00,
  0x20,0x12,0x4A,0x82,0x7F,0x02,0x0A,0x92,0x60,0x1F,0x00,0x00,0xFF,0x00,0x00,0x00,//"新",32
  0x10,0x60,0x02,0x8C,0x00,0x10,0x92,0x52,0x32,0x1E,0x32,0x52,0x92,0x12,0x10,0x00,
  0x04,0x04,0x7E,0x01,0x00,0x21,0x18,0x40,0x80,0x7F,0x08,0x30,0x04,0x09,0x31,0x00,//"添",33
  0x10,0x10,0x10,0xFF,0x10,0x10,0xF0,0x00,0x00,0xF8,0x08,0x08,0x08,0xF8,0x00,0x00,
  0x80,0x40,0x30,0x0F,0x40,0x80,0x7F,0x00,0x00,0x7F,0x20,0x20,0x20,0x7F,0x00,0x00,//"加",34
  0x80,0xFE,0x82,0x82,0xFE,0x80,0xFE,0x82,0x82,0xFE,0x80,0x00,0xF8,0x00,0xFF,0x00,
  0x40,0x3F,0x00,0x20,0xBF,0x40,0x3F,0x40,0x80,0x7F,0x00,0x00,0x4F,0x80,0x7F,0x00,//"删",35
  0x00,0xFE,0x22,0x5A,0x86,0x20,0x10,0x28,0x24,0xE3,0x24,0x28,0x10,0x20,0x20,0x00,
  0x00,0xFF,0x04,0x08,0x27,0x11,0x0D,0x41,0x81,0x7F,0x01,0x05,0x09,0x31,0x00,0x00,//"除",36
  0x00,0x00,0x24,0x24,0x24,0x24,0x24,0xFC,0x22,0x22,0x22,0x23,0x22,0x00,0x00,0x00,
  0x02,0x02,0x02,0x02,0x02,0x42,0x82,0x7F,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x00,//"手",37
  0x10,0x10,0xD0,0xFF,0x90,0x10,0x00,0xFE,0x02,0x02,0x02,0xFE,0x00,0x00,0x00,0x00,
  0x04,0x03,0x00,0xFF,0x00,0x83,0x60,0x1F,0x00,0x00,0x00,0x3F,0x40,0x40,0x78,0x00,//"机",38
  0x10,0x10,0x10,0xFF,0x90,0x20,0x98,0x88,0x88,0xE9,0x8E,0x88,0x88,0xA8,0x98,0x00,
  0x02,0x42,0x81,0x7F,0x00,0x00,0x80,0x84,0x4B,0x28,0x10,0x28,0x47,0x80,0x00,0x00,//"按",39
  0x40,0x30,0xEF,0x24,0x24,0x80,0xE4,0x9C,0x10,0x54,0x54,0xFF,0x54,0x7C,0x10,0x00,
  0x01,0x01,0x7F,0x21,0x51,0x26,0x18,0x27,0x44,0x45,0x45,0x5F,0x45,0x45,0x44,0x00,//"键",40
  0x00,0x00,0xFE,0x22,0x22,0x22,0x22,0xFE,0x22,0x22,0x22,0x22,0xFE,0x00,0x00,0x00,
  0x80,0x60,0x1F,0x02,0x02,0x02,0x02,0x7F,0x02,0x02,0x42,0x82,0x7F,0x00,0x00,0x00,//"用",41
  0x00,0x00,0x00,0xF8,0x08,0x08,0x09,0x0E,0x08,0x08,0x08,0x08,0xF8,0x00,0x00,0x00,
  0x00,0x80,0x60,0x1F,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x03,0x00,0x00,0x00,//"户",42
  0x00,0x00,0x38,0x34,0x02,0x82,0xC2,0x7C,0x38,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x37,0x37,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//"？",43
  0x40,0x20,0xF8,0x07,0xF0,0xA0,0x90,0x4C,0x57,0x24,0xA4,0x54,0x4C,0x80,0x80,0x00,
  0x00,0x00,0xFF,0x00,0x1F,0x80,0x92,0x52,0x49,0x29,0x24,0x12,0x08,0x00,0x00,0x00,//"修",44
  0x04,0x84,0x84,0x84,0x84,0xFC,0x40,0x30,0xCC,0x0B,0x08,0x08,0xF8,0x08,0x08,0x00,
  0x00,0x7F,0x20,0x10,0x10,0x08,0x80,0x40,0x21,0x16,0x08,0x16,0x21,0x40,0x80,0x00,//"改",45
  0x10,0x10,0xD0,0xFF,0x90,0x14,0xE4,0xAF,0xA4,0xA4,0xA4,0xAF,0xE4,0x04,0x00,0x00,
  0x04,0x03,0x00,0xFF,0x00,0x89,0x4B,0x2A,0x1A,0x0E,0x1A,0x2A,0x4B,0x88,0x80,0x00,//"模",46
  0x10,0x10,0x90,0x90,0x90,0x90,0x90,0x10,0x10,0xFF,0x10,0x10,0x11,0x16,0x10,0x00,
  0x00,0x20,0x60,0x20,0x3F,0x10,0x10,0x10,0x00,0x03,0x0C,0x10,0x20,0x40,0xF8,0x00,//"式",47
  0x04,0x84,0xE4,0x5C,0x44,0xC4,0x20,0x10,0xE8,0x27,0x24,0xE4,0x34,0x2C,0xE0,0x00,
  0x02,0x01,0x7F,0x10,0x10,0x3F,0x80,0x60,0x1F,0x09,0x09,0x3F,0x49,0x89,0x7F,0x00,//"确",48
  0x10,0x0C,0x44,0x44,0x44,0x44,0x45,0xC6,0x44,0x44,0x44,0x44,0x44,0x14,0x0C,0x00,
  0x80,0x40,0x20,0x1E,0x20,0x40,0x40,0x7F,0x44,0x44,0x44,0x44,0x44,0x40,0x40,0x00,//"定",49
  0x02,0x02,0xFE,0x92,0x92,0x92,0xFE,0x02,0x06,0xFC,0x04,0x04,0x04,0xFC,0x00,0x00,
  0x08,0x18,0x0F,0x08,0x08,0x04,0xFF,0x04,0x84,0x40,0x27,0x18,0x27,0x40,0x80,0x00,//"取",50
  0x10,0x60,0x02,0x0C,0xC0,0x00,0xE2,0x2C,0x20,0x3F,0x20,0x28,0xE6,0x00,0x00,0x00,
  0x04,0x04,0x7C,0x03,0x00,0x00,0xFF,0x09,0x09,0x09,0x49,0x89,0x7F,0x00,0x00,0x00,//"消",51
  0x40,0x44,0x54,0x65,0xC6,0x64,0x54,0x44,0x00,0xFC,0x44,0x44,0xC4,0x42,0x40,0x00,
  0x20,0x12,0x4A,0x82,0x7F,0x02,0x0A,0x92,0x60,0x1F,0x00,0x00,0xFF,0x00,0x00,0x00,//"新",52
  0x02,0x02,0xF2,0x92,0x92,0x92,0x92,0xFE,0x92,0x92,0x92,0x92,0xF2,0x02,0x02,0x00,
  0x04,0x04,0xFF,0x04,0x04,0x04,0x04,0x07,0x04,0x04,0x44,0x84,0x7F,0x04,0x04,0x00,//"再",53
  0x00,0x02,0x0C,0x80,0x60,0x80,0x40,0x30,0x0F,0xC8,0x08,0x08,0x28,0x18,0x00,0x00,
  0x02,0x02,0x7E,0x01,0x80,0x40,0x20,0x18,0x06,0x01,0x06,0x18,0x20,0x40,0x80,0x00,//"次",54
  0x00,0x00,0xF8,0x88,0x88,0x88,0x88,0x08,0x08,0xFF,0x08,0x09,0x0A,0xC8,0x08,0x00,
  0x80,0x60,0x1F,0x00,0x10,0x20,0x1F,0x80,0x40,0x21,0x16,0x18,0x26,0x41,0xF8,0x00,//"成",55
  0x08,0x08,0x08,0xF8,0x08,0x08,0x08,0x10,0x10,0xFF,0x10,0x10,0x10,0xF0,0x00,0x00,
  0x10,0x30,0x10,0x1F,0x08,0x88,0x48,0x30,0x0E,0x01,0x40,0x80,0x40,0x3F,0x00,0x00,//"功",56
  0x00,0x40,0x30,0x1E,0x10,0x10,0x10,0xFF,0x10,0x10,0x10,0x10,0x10,0x00,0x00,0x00,
  0x81,0x81,0x41,0x21,0x11,0x0D,0x03,0x01,0x03,0x0D,0x11,0x21,0x41,0x81,0x81,0x00,//"失",57
  0x00,0xFE,0x02,0xFA,0x02,0xFE,0x40,0x20,0xD8,0x17,0x10,0x10,0xF0,0x10,0x10,0x00,
  0x80,0x47,0x30,0x0F,0x10,0x67,0x80,0x40,0x21,0x16,0x08,0x16,0x21,0x40,0x80,0x00,//"败",58
  0x00,0x02,0x02,0x02,0x02,0x02,0x02,0xE2,0x22,0x12,0x0A,0x06,0x02,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x40,0x80,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//"了",59
  0x00,0x02,0x02,0xC2,0x02,0x02,0x02,0xFE,0x82,0x82,0x82,0x82,0x82,0x02,0x00,0x00,
  0x40,0x40,0x40,0x7F,0x40,0x40,0x40,0x7F,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x00,//"正",60
  0x00,0x00,0xE2,0x82,0x82,0x82,0x82,0x82,0x82,0x82,0x82,0xFE,0x00,0x00,0x00,0x00,
  0x00,0x00,0x3F,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x78,0x00,0x00,//"已",61
  0x10,0x60,0x02,0x8C,0x00,0x24,0x24,0x2F,0xE4,0x24,0x24,0xE4,0x2F,0x24,0x24,0x00,
  0x04,0x04,0x7E,0x01,0x00,0xFF,0x11,0x09,0x07,0x19,0x09,0x07,0x49,0x91,0x7F,0x00,//"满",62
  0x80,0x80,0x88,0x88,0x88,0x88,0x88,0xFF,0x88,0x88,0x88,0x88,0x88,0x80,0x80,0x00,
  0x20,0x20,0x10,0x08,0x04,0x02,0x01,0xFF,0x01,0x02,0x04,0x08,0x10,0x20,0x20,0x00,//"未",63
  0x80,0x82,0x82,0x82,0xFE,0x82,0x82,0x82,0x82,0x82,0xFE,0x82,0x82,0x82,0x80,0x00,
  0x00,0x80,0x40,0x30,0x0F,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,//"开",64
  0x00,0x00,0xF0,0x10,0x10,0x10,0x10,0xFF,0x10,0x10,0x10,0x10,0xF0,0x00,0x00,0x00,
  0x00,0x00,0x0F,0x04,0x04,0x04,0x04,0xFF,0x04,0x04,0x04,0x04,0x0F,0x00,0x00,0x00,//"中",65
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x18,0x24,0x24,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//"。",66
  
  0x00,0x00,0xF8,0x88,0x88,0x88,0x88,0xFF,0x88,0x88,0x88,0x88,0xF8,0x00,0x00,0x00,
  0x00,0x00,0x1F,0x08,0x08,0x08,0x08,0x7F,0x88,0x88,0x88,0x88,0x9F,0x80,0xF0,0x00,// "电",67
  0x20,0x20,0x20,0xBE,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xBE,0x20,0x20,0x20,0x00,
  0x00,0x80,0x80,0xAF,0xAA,0xAA,0xAA,0xFF,0xAA,0xAA,0xAA,0xAF,0x80,0x80,0x00,0x00,// "量",68
  0x00,0x02,0x02,0x02,0x02,0x82,0x42,0xF2,0x0E,0x42,0x82,0x02,0x02,0x02,0x00,0x00,
  0x10,0x08,0x04,0x02,0x01,0x00,0x00,0xFF,0x00,0x00,0x00,0x01,0x02,0x0C,0x00,0x00,// "不",69
  0x00,0x00,0x00,0x7E,0x42,0x42,0x42,0xC2,0x42,0x42,0x42,0x7E,0x00,0x00,0x00,0x00,
  0x80,0x40,0x30,0x0E,0x10,0x20,0x40,0x7F,0x44,0x44,0x44,0x44,0x44,0x40,0x40,0x00,// "足",70
  
  0x08,0x08,0x89,0xEA,0x18,0x88,0x00,0x04,0x04,0xFC,0x04,0x04,0x04,0xFC,0x00,0x00,
  0x02,0x01,0x00,0xFF,0x01,0x86,0x40,0x20,0x18,0x07,0x40,0x80,0x40,0x3F,0x00,0x00,//"初",71
  0x10,0x10,0xF0,0x1F,0x10,0xF0,0x00,0x40,0xE0,0x58,0x47,0x40,0x50,0x60,0xC0,0x00,
  0x40,0x22,0x15,0x08,0x16,0x21,0x00,0x00,0xFE,0x42,0x42,0x42,0x42,0xFE,0x00,0x00,//"始",72
  0x00,0x80,0x60,0xF8,0x07,0x00,0x00,0x00,0xFF,0x40,0x20,0x10,0x08,0x04,0x00,0x00,
  0x01,0x00,0x00,0xFF,0x00,0x04,0x02,0x01,0x3F,0x40,0x40,0x40,0x40,0x40,0x78,0x00,//"化",73

#endif
};


void DelayMS(uint16 microSecs)  //延时 microSecs * 1ms
{   
     uint16 i = 0,j = 0;
     //while(microSecs--) 
     for(j = microSecs; j>0; j--)
     {     
         /* 32 NOPs == 1 usecs */  
       for(i=656;i>0;i--)
       {
           asm("nop"); asm("nop"); asm("nop"); asm("nop"); asm("nop");     
           asm("nop"); asm("nop"); asm("nop"); asm("nop"); asm("nop");     
           asm("nop"); asm("nop"); asm("nop"); asm("nop"); asm("nop");     
           asm("nop"); asm("nop"); asm("nop"); asm("nop"); asm("nop");     
           asm("nop"); asm("nop"); asm("nop"); asm("nop"); asm("nop");     
           asm("nop"); asm("nop"); asm("nop"); asm("nop"); asm("nop");     
           asm("nop"); asm("nop");         
       }
        
     }

 }


//初始化， dev_addr iic 设备地址
void   HalSensorInit(uint8 dev_addr )
{
//  static uint8 controlLEDFlag = 0;
  HalI2CInit(dev_addr, i2cClock_123KHZ);

   
}
 
/**************************************************************************************************
 * @fn          MBR3_I2C_Read
 *
 * @brief        写N个字节到MBR3按键相应寄存器中
 *               
 *
 * @param       addr - which register to read
 * @param       buf - pointer to buffer to place data
 * @param       len - numbver of bytes to read
 *
 * @return      0:真    -1:假
 
 **************************************************************************************************/
uint8 MBR3_I2C_Read( uint8 addr, uint8 len, uint8 *buf)
{
    bool ret;

    ret = HalSensorReadReg( addr, buf, len );

    return ret ? 0 : -1;
}

/**************************************************************************************************
 * @fn          MBR3_I2C_Write
 *
 * @brief        写N个字节到MBR3按键相应寄存器中
 *               
 *
 * @param       addr - which register to read
 * @param       buf - pointer to buffer to place data
 * @param       len - numbver of bytes to read
 *
 * @return      0:真    -1:假
 
 **************************************************************************************************/
uint8 MBR3_I2C_Write( uint8 addr, uint8 len, uint8 *buf)
{		
    bool ret;
    
    ret = HalSensorWriteReg(addr, buf, len);

    return ret ? 0 : -1;
}


/**************************************************************************************************
 * @fn          HalSensorReadReg
 *
 * @brief       This function implements the I2C protocol to read from a sensor. The sensor must
 *              be selected before this routine is called.
 *
 * @param       addr - which register to read
 * @param       pBuf - pointer to buffer to place data
 * @param       nBytes - numbver of bytes to read
 *
 * @return      TRUE if the required number of bytes are reveived
 **************************************************************************************************/
bool HalSensorReadReg(uint8 addr, uint8 *pBuf, uint8 nBytes)
{
  uint8 i = 0;

  /* Send address we're reading from */
  if (HalI2CWrite(1,&addr) == 1)
  {
    /* Now read data */
    i = HalI2CRead(nBytes,pBuf);
  }

  return i == nBytes;
}

/**************************************************************************************************
* @fn          HalSensorWriteReg
* @brief       This function implements the I2C protocol to write to a sensor. he sensor must
*              be selected before this routine is called.
*
* @param       addr - which register to write
* @param       pBuf - pointer to buffer containing data to be written
* @param       nBytes - number of bytes to write
*
* @return      TRUE if successful write
*/
bool HalSensorWriteReg(uint8 addr, uint8 *pBuf, uint8 nBytes)
{
  uint8 i;
  uint8 *p = buffer;

  /* Copy address and data to local buffer for burst write */
  *p++ = addr;
  for (i = 0; i < nBytes; i++)
  {
    *p++ = *pBuf++;
  }
  nBytes++;

  /* Send address and data */
  i = HalI2CWrite(nBytes, buffer);
  //if ( i!= nBytes)
  //  HAL_TOGGLE_LED2();

  return (i == nBytes);
}

/*************************************************************************
* @fn          HalOLedReadReg
* @brief       This function implements the I2C protocol to write to a sensor. he sensor must
*              be selected before this routine is called.
*
* @param       addr - which register to write
* @param       pBuf - pointer to buffer containing data to be written
* @param       nBytes - number of bytes to write
*
* @return      TRUE if successful write
*************************************************************************/

bool HalOLedReadReg(uint16 addr, uint8 *pBuf, uint8 nBytes)
{
  uint8 i = 0;
  uint8 addrH, addrL;

  addrL = addr & 0xff;
  addrH = addr >> 8;

  /* Send address we're reading from */
  if (HalI2CWrite(1, &addrH) == 1)
  if (HalI2CWrite(1, &addrL) == 1)
  {
  /* Now read data */
  i = HalI2CRead(nBytes,pBuf);
  }

  return i == nBytes;
}

/*************************************************************************
* @fn          HalOLedWriteReg
* @brief       This function implements the I2C protocol to write to a sensor. he sensor must
*              be selected before this routine is called.
*
* @param       addr - which register to write
* @param       pBuf - pointer to buffer containing data to be written
* @param       nBytes - number of bytes to write
*
* @return      TRUE if successful write
*************************************************************************/
bool HalOLedWriteReg(uint16 addr, uint8 *pBuf, uint8 nBytes)
{
  uint8 i;
  uint8 *p = buffer;
  uint8 addrL = 0, addrH = 0;

  addrL = (uint8)(addr & 0xff);
  addrH = (uint8)(addr >> 8);

  /* Copy address and data to local buffer for burst write */
  *p++ = addrH;
  *p++ = addrL;
  for (i = 0; i < nBytes; i++)
  {
  *p++ = *pBuf++;
  }
  nBytes += 2;

  /* Send address and data */
  i = HalI2CWrite(nBytes, buffer);


  return (i == nBytes);
}


/*********************************************************************
*********************************************************************/

void LCD_RST(void)
{
  P1SEL &= ~(BV(0)); // Configure Port 1.0 as GPIO

  P1DIR |= BV(0); // Port 1.0 as output,

  P1 &= ~(BV(0));   // 为低

  for(uint8 i=0;i<8;i++);

  P1 |= BV(0);

  for(uint8 j=0;j<20;j++);
}


/***********************************************/
//原型:  void IIC_Bus_Init()
//功能:  IIC通信引脚以及功能分配初始化
//参数:  无
//返回值:无
/***********************************************/
void IIC_Bus_Init()
{ 
  LCD_RST();
  HalI2CInit(Slave_Address, i2cClock_123KHZ) ;
}


/***********************************************/
//原型:  void Write_Command(u8 command)
//功能:  IIC写一个命令
//参数:  无
//返回值:无
/***********************************************/

void Write_Command(uint8 command)
{
  uint8 OP_COM[2] = {0x00};
  
  OP_COM[1] = command;
  
  HalI2COLEDInit(Slave_Address, i2cClock_123KHZ) ;
  
//  HalI2CWrite(1,&OP_COM[0]);
  
//  while(!HalI2CWrite(1, &OP_COM[1]));
  
  while(!HalSensorWriteReg(OP_COM[0], &OP_COM[1], 1));
  
//  while(!HalOLedWriteReg(OP_COM[0], &OP_COM[1], 2));

}

/***********************************************/
//原型:  void Write_Data(u8 date) 
//功能:  IIC通信写一个数据
//参数:  无
//返回值:无
/***********************************************/
//

void Write_Data(uint8 date)  
{
  uint8 OP_COM[2] = {0x40,0x00};

  OP_COM[1] = date;
  
  HalI2COLEDInit(Slave_Address, i2cClock_123KHZ) ;
  
//  HalI2CWrite(1,&OP_COM[0]);
  
//  while(!HalI2CWrite(1, &OP_COM[1]));

  while(!HalSensorWriteReg(OP_COM[0], &OP_COM[1], 1));
  
  //  while(!HalOLedWriteReg(OP_COM[0], &OP_COM[1], 2));
}

/***********************************************/
//原型:  void OLED_Init()
//功能:  OLED的初始化
//参数:  无
//返回值:无
/***********************************************/

void OLED_Init()
{
    IIC_Bus_Init();
    
    LCD_RST();                    //复位IC
    
    Write_Command(0xAE); //Set Display Off 
    Write_Command(0xd5); //displaydivide ratio/osc. freq. mode      
    Write_Command(0x91); // 
    Write_Command(0xA8); //multiplex ration mode:63 
    Write_Command(0x1F); 
    Write_Command(0xD3); //Set Display Offset 
    Write_Command(0x00); 
    Write_Command(0x40); //Set Display Start Line 
    Write_Command(0xAD);   //DC-DC Control Mode Set  
    Write_Command(0x8b); //DC-DC ON/OFF Mode Set 
    Write_Command(0x32); //Set Pump voltage value 
    Write_Command(0xA1); //Segment Remap  
    Write_Command(0xC8); //Sst COM Output Scan Direction  
    Write_Command(0xDA); //common pads hardware: alternative  
    Write_Command(0x02); 
    Write_Command(0x81); //contrast control 
    Write_Command(0x33);   // 
    Write_Command(0xD9); //set pre-charge period  
    Write_Command(0x1f); 
    Write_Command(0xDB);  //VCOM deselect level mode  
    Write_Command(0x40);  // 
    Write_Command(0xA4);  //Set Entire Display On/Off 
    Write_Command(0xA6); //Set Normal Display 
    Write_Command(0xAF); //Set Display On 
   
//   Write_Command(0xA5);  //全屏点亮
    Clear_Screen(0);
 
}



/***********************************************/
//原型: void Clear_Screen(unsigned char pos)
//功能:  清屏
//参数:  pos:0――清全屏
//           1――清上半屏
//           2――清下半屏
//返回值:无
/***********************************************/

void Clear_Screen(uint8 pos)
{
   uint8 page_number,column_number;
   uint8 head,end;
   
   if(pos==0)
   {
   	 head=MIN_M;
   	 end=PAGE_TOTAL/2;
   }
   else if(pos==1)
   {
   	 head=MIN_M;
   	 end=PAGE_TOTAL/4;   	 
   }
   else 
   {
   	 head=2;
   	 end=PAGE_TOTAL/2;
   }
   
   for(page_number=head;page_number<end;page_number++)
   {
     Write_Command(START_PAGE+page_number);
     Write_Command(START_HIGH_BIT);
     Write_Command(START_LOW_BIT);
     for(column_number=MIN_M;column_number<COLUMN_MAX;column_number++)
     {
        Write_Data(STATE_MIN);
     }
   }
}

/***********************************************/
//原型: void WriteGB(unsigned int Cx,unsigned int Cy,unsigned int No,unsigned int const   *pstr)
//功能:  向OLED写入一个汉字
//参数:  Cx-列坐标，Cy-行坐标，No-汉字码在数组中的位置编号，pstr-汉字码数组地址
//返回值:无
/***********************************************/
void WriteGB(uint16 Cx,uint16 Cy,uint16 No,uint16 const   *pstr)
// (Cx,Cy) 中文汉字显示位置坐标，Cx以列为单位，Cy以字符行为单位   
// pstr：字符数组 16*16点阵汉字字符,No为字符在数组中的位置编号
{
  uint16 const  *addr;
  uint16 Col,Page,No_ch;	
  uint8 i,j; 

  Col=Cx*16;
  Page=Cy*2;
  No_ch=No*32; 

  addr=pstr+No_ch;

  for(i=0;i<2;i++)
  {
   Write_Command(0xb0+i+Page);
   Write_Command(0x10+Col/16);
   Write_Command(0x00+Col%16);
   
   for(j=0;j<16;j++)
   {
	Write_Data(*addr++);	
   }
  }
}



/***********************************************/
//原型:  void WriteNChar(unsigned int Cx,unsigned int Cy,unsigned int No,unsigned int const *pstr)
//功能:  向OLED写入字符
//参数:  Cx-列坐标，Cy-行坐标，No-字符在数组中的位置编号，pstr-字符数组地址
//返回值:无
/***********************************************/
void WriteNChar(uint16 Cx,uint16 Cy,uint16 No,uint16 const *pstr)
// (Cx,Cy) 显示位置坐标，Cx以列为单位，Cy以字符行为单位   
// pstr：字符数组 16*16点阵字符,No为字符在数组中的位置编号
{
	
  uint16 Col,Page;	
  uint8 i,j,k; 
  
  Col=Cx*16;
  Page=Cy*2;
  
  for(k=0;k<No;k++)
  {    
          
    for(i=0;i<2;i++)
    {
    
      Write_Command(0xb0+Page+i);
      Write_Command(0x10+(Col+k*16)/16);
      Write_Command(0x00+(Col+k*16)%16);		
      for(j=0;j<8;j++)
      {
              Write_Data(*pstr++);	
      }
    }
  }

  
}

/*******************功能描述：显示8*16一组标准ASCII字符串     显示的坐标（x,y），y为页范围0～7****************/
/********************************
* x: x轴
* y: 0 为第一行，2为第二行  8*16模式
*
************************************************************************************************************/
void LCD_P8x16Str(uint8 x, uint8 y,uint8 ch[])
{
  uint8 c=0,i=0,j=0,k=0;
    
  while (ch[k]!='\0')
  {    
    c =ch[k]-32;
    if(x>120){x=0;y++;}
    
    for(i=0;i<2;i++)
    {
      Write_Command(0xb0+y+i);
      Write_Command(0x10+x/8);
      Write_Command(0x00+x%8); 
      for(j=0;j<8;j++)
      {    
        Write_Data(Font_Menu_Num[c*16+j+i*8]);
      }
    }
      
    x+=8;
    k++;
    
   
  }
}


/*****************功能描述：显示16*16点阵  显示的坐标（x,y），y为页范围0～2****************************/
void LCD_P16x16Ch(unsigned char x, unsigned char y, unsigned char N, unsigned char const* Str)
{
    unsigned char wm=0;
    unsigned int adder=32*N;  //      
    Write_Command(0xb0+y);
    Write_Command(0x10+x/16);
    Write_Command(0x00+x%16); 
    for(wm = 0;wm < 16;wm++)  //             
    {
        Write_Data(Str[adder]);    
        adder += 1;
    }      
    Write_Command(0xb0+y+1);
    Write_Command(0x10+x/16);
    Write_Command(0x00+x%16); 
    for(wm = 0;wm < 16;wm++) //         
    {
        Write_Data(Str[adder]);
        adder += 1;
    }          
}
/*********************************************************************
*********************************************************************/

